generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"

  // Optional Prisma Client Generator configuration
  runtime                = "nodejs"
  moduleFormat           = "cjs"
  generatedFileExtension = "ts"
}

datasource db {
  provider = "postgresql"
}

// ------------------------------------------------------
// Authentications
// ------------------------------------------------------

enum Role {
  ADMIN
  CUSTOMER
}

model Account {
  id                 String              @id @default(uuid())
  email              String              @unique
  password           String?
  role               Role
  providerId         String? // "google", "github", etc.
  providerAccountId  String? // "1234567890"
  isEmailVerified    Boolean             @default(false)
  sessions           Session[]
  verificationTokens VerificationToken[]
  customer           Customer?
  admin              Admin?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  @@unique([providerId, providerAccountId, role])
  @@index([providerId, providerAccountId])
}

model Session {
  id        String   @id @default(uuid())
  account   Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId String
  ipAddress String? // Optional : tracking for security
  userAgent String? // Optional : tracking for security
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([expiresAt])
  @@index([accountId])
}

model Customer {
  id          String   @id @default(uuid())
  account     Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId   String   @unique
  country     Country? @relation(fields: [countryCode], references: [iso2Code])
  countryCode String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Admin {
  id        String   @id @default(uuid())
  account   Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  id        String           @id @default(uuid())
  token     String           @unique
  type      VerificationType // enum: PASSWORD_RESET, EMAIL_VERIFICATION, etc.
  value     String? // optional value being verified
  accountId String
  account   Account          @relation(fields: [accountId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  @@index([expiresAt])
}

enum VerificationType {
  PASSWORD_RESET
  EMAIL_VERIFICATION
  TWO_FACTOR
}

// ------------------------------------------------------
// Common models
// ------------------------------------------------------

model Media {
  id        String   @id @default(uuid())
  fileName  String
  key       String
  mimeType  String
  size      Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// data from https://www.insee.fr/fr/information/7766585 -> Pays et territoires Ã©trangers
model Country {
  id            String  @id @default(uuid())
  countryName   String
  iso2Code      String  @unique // ISO 3166-1 alpha-2 code (FR, DE, ES, IT, etc..)
  iso3Code      String  @unique // ISO 3166-1 alpha-3 code (FRA, DEU, ESP, ITA, etc..)
  num3Code      String  @unique // ISO 3166-1 numeric-3 code (250, 276, 724, 380, etc..)
  inseeCode     String?
  continent     String?
  continentName String?
  currencyCode  String?
  population    Int?    @default(0)

  customers Customer[]
}

// ------------------------------------------------------
// Business models
// ------------------------------------------------------

model AppConfig {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
